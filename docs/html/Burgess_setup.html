
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Instructions for steering wheel setup: software</title><meta name="generator" content="MATLAB 9.6"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2020-06-24"><meta name="DC.source" content="Burgess_setup.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Instructions for steering wheel setup: software</h1><!--introduction--><p>Our laboratory developed a steering wheel setup to probe mouse behavior(1). In this setup, a mouse turns a steering wheel with its front paws to indicate whether a visual stimulus appears to its left or to its right.</p><p>This setup is being adopted in multiple laboratories, from Stanford to Tokyo, and is being deployed by the International Brain Laboratory.</p><p>To facilitate this deployment, we provide instructions to build the setup with components that are entirely off-the-shelf or 3-D printed.  You can find the hardware setup instructions <a href="Burgess_hardware_setup.html">here</a>.</p><p><img vspace="5" hspace="5" src="SteeringWheelBack.png" alt=""> </p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Introduction</a></li><li><a href="#2">Installing Rigbox</a></li><li><a href="#3">Setup</a></li><li><a href="#4">Calibrations</a></li><li><a href="#5">Running an experiment</a></li><li><a href="#6">Notes</a></li><li><a href="#7">Etc.</a></li></ul></div><h2 id="1">Introduction</h2><p>This document gives instructions on how to build a basic version of the steering wheel setup to probe mouse behavior, introduced by Burgess et al. The goal is to make it easy for other laboratories, including those that make the International Brain Laboratory, to replicate the task and extend it in various directions. To this end, these instructions rely entirely on materials that can be bought off the shelf, or ordered online based on 3-D drawings. In this steering wheel setup, we place a steering wheel under the front paws of a head-fixed mouse, and we couple the wheel's rotation to the horizontal position of a visual stimulus on the screens. Turning the wheel left or right moves the stimulus left or right. The mouse is then trained to decide whether a stimulus appears on its left or its right. Using the wheel, the mouse indicates its choice by moving the stimulus to the center. A correct decision is rewarded with a drop of water and short intertrial interval, while an incorrect decision is penalized with a longer timeout and auditory noise. We use this setup throughout our laboratory, and deploy it in training rigs and experimental rigs. Training rigs are used to train head-fixed mice on the steering-wheel task and acquire behavioral data. Experimental rigs have additional apparatus to collect electrophysiological and imaging data, measure eye movements and licking activity, provide optogenetic perturbations, and so on. Up until recently, constructing these setups required a machine shop that could provide custom-made components. However, for the purposes of spreading this setup to other laboratories, we here describe a new version that does not require a machine shop: all components can be ordered online or 3D-printed.</p><h2 id="2">Installing Rigbox</h2><p>Before configuring the settings, please follow the <a href="install.html">installation instructions</a> to install Rigbox and its dependencies.</p><h2 id="3">Setup</h2><p>Follow the <a href="./paths_config.html">setting up dat.paths</a> guide to set up rig paths.  This sets the location of the data repositories and hardware settings files.</p><p>The below code will create a hardware settings file for the Burgess wheel task.  It can be run from the command window by typing <tt>hw.setupBurgessDefaults</tt>.  For details of what the code does, or to customize the hardware, see the <a href="./hardware_config.html">hardware config guide</a>. <b>*NB</b>*: The below code must be run on the stimulus computer.</p><pre class="language-matlab">
<span class="comment">%%% DEFAULT HARDWARE CONFIGURATION FOR THE BURGESS WHEEL TASK %%%</span>
<span class="comment">% Saves the config settings for a rig that's set up following the Burgess</span>
<span class="comment">% hardware setup instructions for running the steering wheel task.  This</span>
<span class="comment">% script should be run on a stimulus computer.  Note that it will overwrite</span>
<span class="comment">% the hardware or remote config files if they already exist.</span>
<span class="comment">%</span>
<span class="comment">% See also docs/scripts/Burgess_setup.m</span>

<span class="comment">% The hardware device settings are stored in a MAT file named 'hardware',</span>
<span class="comment">% defined in dat.paths</span>
hardware = fullfile(getOr(dat.paths, <span class="string">'rigConfig'</span>), <span class="string">'hardware.mat'</span>);
<span class="comment">% The stimulus controllers are loaded from a MAT file with the name</span>
<span class="comment">% 'remote' in the globalConfig directory, defined in dat.paths:</span>
remote = fullfile(getOr(dat.paths, <span class="string">'globalConfig'</span>), <span class="string">'remote.mat'</span>);

<span class="comment">% Check whether these files already exist</span>
<span class="keyword">if</span> any(file.exists({hardware, remote}))
  prompt = [<span class="string">'A hardware and/or remote settings file already exists. '</span> <span class="keyword">...</span>
            <span class="string">'Do you want to overwrite them? Y/N [N]: '</span>];
  str = input(prompt, <span class="string">'s'</span>);
  <span class="keyword">if</span> isempty(str) || strcmpi(str, <span class="string">'n'</span>)
    <span class="keyword">return</span>
  <span class="keyword">elseif</span> ~strcmpi(str, <span class="string">'y'</span>)
    error(<span class="string">'User input not understood'</span>)
  <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment">%%% Window</span>
stimWindow = hw.ptb.Window;
<span class="comment">% This setting assumes the stimulus monitors are the primary screen (i.e.</span>
<span class="comment">% the Windows menu bar is shown on these monitors.</span>
stimWindow.ScreenNum = 0; 
stimWindow.positionSyncRegion(<span class="string">'NorthEast'</span>, 100, 100)
stimWindow.PxDepth = Screen(<span class="string">'PixelSize'</span>, stimWindow.ScreenNum);
stimWindow.BackgroundColour = 127*[1 1 1];
stimWindow.MonitorId = <span class="string">'LG LP097QX1'</span>; <span class="comment">% The screens used in Burgess et al.</span>

save(hardware, <span class="string">'stimWindow'</span>) <span class="comment">% Save the stimWindow to file</span>

<span class="comment">%%% Viewing model</span>
<span class="comment">% First define some physical dimentions in cm:</span>
screenDimsCm = [19.6 14.7]; <span class="comment">%[width_cm heigh_cm], each screen is the same</span>
centerPt = [0, 0, 9.5]; <span class="comment">% [x, y, z], observer position in cm. z = dist from screen</span>
centerPt(2,:) = [0, 0, 10];<span class="comment">% Middle screen, observer slightly further back</span>
centerPt(3,:) = centerPt; <span class="comment">% Observer equidistant from left and right motitors </span>
angle = [-90; 0; 90]; <span class="comment">% The angle of the screen relative to the observer</span>

<span class="comment">% Define the pixel dimentions for the monitors</span>
r = Screen(<span class="string">'Resolution'</span>, stimWindow.ScreenNum); <span class="comment">% Returns the current resolution</span>
pxW = r.width; <span class="comment">% e.g. 1280</span>
pxH = r.height; <span class="comment">% e.g. 1024</span>

<span class="comment">% Plug these values into the screens function:</span>
screens(1) = vis.screen(centerPt(1,:), angle(1), screenDimsCm, [0 0 pxW pxH]);        <span class="comment">% left screen</span>
screens(2) = vis.screen(centerPt(2,:), angle(2), screenDimsCm, [pxW 0 2*pxW pxH]);    <span class="comment">% ahead screen</span>
screens(3) = vis.screen(centerPt(3,:), angle(3), screenDimsCm, [2*pxW  0 3*pxW pxH]); <span class="comment">% right screen</span>

save(hardware, <span class="string">'screens'</span>, <span class="string">'-append'</span>);

<span class="comment">%%% Inputs</span>
mouseInput = hw.DaqRotaryEncoder;
save(hardware, <span class="string">'mouseInput'</span>, <span class="string">'-append'</span>)

<span class="comment">%%% Outputs</span>
daqController = hw.DaqController;
<span class="comment">% Add a new channel</span>
daqController.ChannelNames = {<span class="string">'rewardValve'</span>};
<span class="comment">% Define the channel ID to output on</span>
daqController.DaqChannelIds = {<span class="string">'ai0'</span>};
<span class="comment">% Add a signal generator that will return the correct samples for</span>
<span class="comment">% delivering a reward of a specified volume</span>
daqController.SignalGenerators(1) = hw.RewardValveControl;

<span class="comment">% Save your hardware file</span>
save(hardware, <span class="string">'daqController'</span>, <span class="string">'-append'</span>);

<span class="comment">%%% Timeline</span>
<span class="comment">% Timeline will be off by default</span>
timeline = hw.Timeline;
timeline.UseTimeline = False;
<span class="comment">% Save your hardware.mat file</span>
save(hardware, <span class="string">'timeline'</span>, <span class="string">'-append'</span>)

<span class="comment">%%% Scale</span>
<span class="comment">% Assumes the scale model 'ES-300HA' connected on COM1</span>
scale = hw.WeighingScale;
save(hardware, <span class="string">'scale'</span>, <span class="string">'-append'</span>)

<span class="comment">%%% Audio</span>
fprintf([<span class="string">'To select the correct audio device, we will cycle through each '</span><span class="keyword">...</span>
      <span class="string">'audio device playing white noise through all channels for 2 '</span><span class="keyword">...</span>
      <span class="string">'seconds.\nThe lowest latency devices are selected first.\n'</span><span class="keyword">...</span>
      <span class="string">'Press the space bar when you hear noise coming through your '</span><span class="keyword">...</span>
      <span class="string">'speakers and the current device will be saved into your '</span><span class="keyword">...</span>
      <span class="string">'hardware file.\nPress any other key to proceed to the next device.\n'</span>])
input(<span class="string">'Press enter to continue'</span>)
hw.testAudioOutputDevices(<span class="string">'SaveAsDefault'</span>, true);

<span class="comment">%%% Websockets</span>
<span class="comment">% Let's create a new stimulus controller</span>
name = ipaddress(hostname);
stimulusControllers = srv.StimulusControl.create(name);
<span class="comment">% Save your new configuration</span>
save(remote, <span class="string">'stimulusControllers'</span>)

</pre><h2 id="4">Calibrations</h2><p>Once the hardware file has been set up, you can start the experiment server by running <tt>srv.expServer</tt>.  A grey Psychtoolbox window should appear on the three screens.</p><p>To calibrate the screens, press the <tt>g</tt> key and follow the steps. To calibrate the reward valve, ensure you have a set of scales connected to the computer (to the port set above in the previous section) and place them below the water spout.  Place a container on the scales to collect the water.  Press the <tt>c</tt> key to start the calibration.</p><p>Press the <tt>q</tt> key to quit.</p><h2 id="5">Running an experiment</h2><p>To run a test experiment (the ChoiceWorld experiment described in the paper), type the following into the MATLAB command window:</p><pre class="language-matlab">cd(fullfile(getOr(dat.paths, <span class="string">'rigbox'</span>), <span class="string">'signals'</span>, <span class="string">'docs'</span>, <span class="string">'examples'</span>))
eui.SignalsTest(<span class="string">'advancedChoiceWorld'</span>)
</pre><p>More information on using this GUI and creating/modifying experiments can be found under the 'Creating experiments' guide on the <a href="index.html">documentation homepage</a>.</p><h2 id="6">Notes</h2><p>(1) <a href="https://doi.org/10.1016/j.celrep.2017.08.047">DOI:10.1016/j.celrep.2017.08.047</a></p><h2 id="7">Etc.</h2><p>Authors: Lauren E Wool, Miles Wells, Hamish Forrest, and Matteo Carandini</p><p>v1.5.0</p><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2019a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Instructions for steering wheel setup: software
% Our laboratory developed a steering wheel setup to probe mouse
% behavior(1). In this setup, a mouse turns a steering wheel with its front
% paws to indicate whether a visual stimulus appears to its left or to its
% right.
%
% This setup is being adopted in multiple laboratories, from Stanford to
% Tokyo, and is being deployed by the International Brain Laboratory.
%
% To facilitate this deployment, we provide instructions to build the setup
% with components that are entirely off-the-shelf or 3-D printed.  You can
% find the hardware setup instructions <Burgess_hardware_setup.html here>.
% 
% <<SteeringWheelBack.png>>
% 

%% Introduction
% This document gives instructions on how to build a basic version of the
% steering wheel setup to probe mouse behavior, introduced by Burgess et
% al. The goal is to make it easy for other laboratories, including those
% that make the International Brain Laboratory, to replicate the task and
% extend it in various directions. To this end, these instructions rely
% entirely on materials that can be bought off the shelf, or ordered online
% based on 3-D drawings. In this steering wheel setup, we place a steering
% wheel under the front paws of a head-fixed mouse, and we couple the
% wheel's rotation to the horizontal position of a visual stimulus on the
% screens. Turning the wheel left or right moves the stimulus left or
% right. The mouse is then trained to decide whether a stimulus appears on
% its left or its right. Using the wheel, the mouse indicates its choice by
% moving the stimulus to the center. A correct decision is rewarded with a
% drop of water and short intertrial interval, while an incorrect decision
% is penalized with a longer timeout and auditory noise. We use this setup
% throughout our laboratory, and deploy it in training rigs and
% experimental rigs. Training rigs are used to train head-fixed mice on the
% steering-wheel task and acquire behavioral data. Experimental rigs have
% additional apparatus to collect electrophysiological and imaging data,
% measure eye movements and licking activity, provide optogenetic
% perturbations, and so on. Up until recently, constructing these setups
% required a machine shop that could provide custom-made components.
% However, for the purposes of spreading this setup to other laboratories,
% we here describe a new version that does not require a machine shop: all
% components can be ordered online or 3D-printed.

%% Installing Rigbox
% Before configuring the settings, please follow the <install.html
% installation instructions> to install Rigbox and its dependencies.

%% Setup
% Follow the <./paths_config.html setting up dat.paths> guide to set up rig
% paths.  This sets the location of the data repositories and hardware
% settings files.
%
% The below code will create a hardware settings file for the Burgess wheel
% task.  It can be run from the command window by typing
% |hw.setupBurgessDefaults|.  For details of what the code does, or to
% customize the hardware, see the <./hardware_config.html hardware config
% guide>.  
% **NB**: The below code must be run on the stimulus computer.
% 
% <include>../../cortexlab/+hw/setupBurgessDefaults.m</include>
%

%% Calibrations
% Once the hardware file has been set up, you can start the experiment
% server by running |srv.expServer|.  A grey Psychtoolbox window should
% appear on the three screens.  
%
% To calibrate the screens, press the |g| key and follow the steps. To
% calibrate the reward valve, ensure you have a set of scales connected to
% the computer (to the port set above in the previous section) and place
% them below the water spout.  Place a container on the scales to collect
% the water.  Press the |c| key to start the calibration.
%
% Press the |q| key to quit.

%% Running an experiment
% To run a test experiment (the ChoiceWorld experiment described in the
% paper), type the following into the MATLAB command window:
%
%   cd(fullfile(getOr(dat.paths, 'rigbox'), 'signals', 'docs', 'examples'))
%   eui.SignalsTest('advancedChoiceWorld')
%
% More information on using this GUI and creating/modifying experiments can
% be found under the 'Creating experiments' guide on the <index.html
% documentation homepage>.

%% Notes
% (1) <https://doi.org/10.1016/j.celrep.2017.08.047 DOI:10.1016/j.celrep.2017.08.047>

%% Etc.
% Authors: Lauren E Wool, Miles Wells, Hamish Forrest, and Matteo Carandini
%
% v1.5.0
##### SOURCE END #####
--></body></html>